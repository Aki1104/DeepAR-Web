<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AR Canvas</title>
    <link href="https://fonts.googleapis.com/css2?family=Caveat&display=swap" rel="stylesheet" />
    <!-- DeepAR browser SDK v5.6.3 (pre-deprecation for foot tracking) -->
    <script src="https://cdn.jsdelivr.net/npm/deepar@5.6.3/js/deepar.js"></script>
</head>
<body>
    <!-- AR preview container -->
    <div style="width: 480px; height: 270px" id="deepar-div"></div>
    <!-- Filter selection buttons -->
    <div>
        <button onclick="switchEffect('./effects/filters/basketball_black.deepar')">Black Shoes</button>
        <button onclick="switchEffect('./effects/filters/basketball_blue.deepar')">Blue Shoes</button>
        <button onclick="switchEffect('./effects/filters/basketball_red.deepar')">Red Shoes</button>
        <button onclick="switchEffect('./effects/filters/basketball_white.deepar')">White Shoes</button>
    </div>

    <!-- DeepAR initialization and effect switch -->
    <script>
        let deepAR;

        (async function () {
            try {
                deepAR = await deepar.initialize({
                    licenseKey: '247704b47c32f030b2b526dde74bc7220426d3f3f390f51ed573bf0da398e590bc8f12a8923a7da4',
                    previewElement: document.querySelector('#deepar-div'),
                }, {
                    additionalOptions: {
                        cameraConfig: {
                            facingMode: 'environment', // Back camera
                            mirrorCamera: false // Disable mirroring for back camera
                        }
                    }
                });
                console.log("‚úÖ DeepAR initialized with back camera.");

                // Load initial effect (e.g., black shoes)
                await deepAR.switchEffect('./effects/filters/basketball_black.deepar');
                console.log('‚úÖ Initial shoe effect loaded successfully!');

                deepAR.callbacks.onFeetVisibilityChanged = (visible) => {
                    console.log(visible ? 'üëü Feet detected!' : 'No feet visible.');
                };
            } catch (err) {
                console.error("‚ùå Error:", err);
            }
        })();

        // Function to switch effects
        async function switchEffect(effectPath) {
            try {
                if (!deepAR) throw new Error('DeepAR not initialized');
                await deepAR.switchEffect(effectPath);
                console.log(`‚úÖ Switched to effect: ${effectPath}`);
            } catch (err) {
                console.error("‚ùå Failed to switch effect:", err);
            }
        }
    </script>
</body>
</html>